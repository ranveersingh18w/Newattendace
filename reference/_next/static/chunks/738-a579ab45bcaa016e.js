"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[738],{5221:(e,t,a)=>{a.d(t,{g:()=>n});var r=a(95155),o=a(66766),s=a(53999);function n(e){let{width:t=220,height:a=58,className:n="",responsive:l=!0}=e;return(0,r.jsx)(o.default,{src:"/techno-njr-logo.png",alt:"Techno NJR Logo",width:t,height:a,className:(0,s.cn)("h-auto object-contain",l?"w-[150px] sm:w-[180px] md:w-[220px]":"",n),priority:!0})}},19764:(e,t,a)=>{a.d(t,{v:()=>l});var r=a(95155),o=a(12115),s=a(31886);let n=()=>{let e=localStorage.getItem("studentToken");if(!e)throw Error("No student authentication token found");return(0,s.hU)(e)};function l(e){let{src:t,alt:a,className:l,role:i="user",isPreview:c=!1}=e,[d,h]=(0,o.useState)(void 0),[u,f]=(0,o.useState)(!0);return((0,o.useEffect)(()=>{if(!t){console.log("AuthenticatedImage: No src provided"),f(!1);return}if(console.log("AuthenticatedImage: src provided:",t),c||t.startsWith("data:")||t.startsWith("blob:")){console.log("AuthenticatedImage: Using preview/data URL directly"),h(t),f(!1);return}return(async()=>{try{let e;console.log("AuthenticatedImage: Fetching image for role:",i),console.log("AuthenticatedImage: src:",t);let a=t.split(/[/\\]/).pop();if(console.log("AuthenticatedImage: filename extracted:",a),"student"===i){console.log("AuthenticatedImage: Using student API");let a=t.split(/[/\\]/),r=a[a.length-1];console.log("AuthenticatedImage: filename from path:",r);let o=r.match(/^student-([^-]+)-/);if(localStorage.getItem("studentToken"))console.log("AuthenticatedImage: Student is logged in, using student API"),e=await n().get("/student/dashboard/profile-picture",{responseType:"blob"});else if(o){console.log("AuthenticatedImage: Staff viewing student profile picture");let t=o[1];console.log("AuthenticatedImage: extracted student ID:",t),e=await (0,s.Cc)().get("/student/dashboard/profile-picture/".concat(t),{responseType:"blob"})}else throw console.error("AuthenticatedImage: Could not extract student ID and no student token found"),Error("Cannot load student profile picture")}else"admin"===i?(console.log("AuthenticatedImage: Using admin API"),e=await (0,s.Cc)().get("/admin/profile-picture/".concat(a),{responseType:"blob"})):"teacher"===i?(console.log("AuthenticatedImage: Using teacher API"),e=await (0,s.Cc)().get("/teacher/profile-picture/".concat(a),{responseType:"blob"})):"hod"===i?(console.log("AuthenticatedImage: Using HOD API"),e=await (0,s.Cc)().get("/hod/profile-picture/".concat(a),{responseType:"blob"})):"director"===i?(console.log("AuthenticatedImage: Using director API"),e=await (0,s.Cc)().get("/director/profile-picture/".concat(a),{responseType:"blob"})):(console.log("AuthenticatedImage: Using default admin API"),e=await (0,s.Cc)().get("/admin/profile-picture/".concat(a),{responseType:"blob"}));let r=URL.createObjectURL(e.data);console.log("AuthenticatedImage: Created blob URL:",r),h(r)}catch(r){var e,a;console.error("AuthenticatedImage: Failed to fetch profile picture:",r),console.error("AuthenticatedImage: Error response:",null==r?void 0:null===(e=r.response)||void 0===e?void 0:e.status,null==r?void 0:null===(a=r.response)||void 0===a?void 0:a.data),console.error("AuthenticatedImage: Role:",i,"Src:",t)}finally{f(!1)}})(),()=>{d&&d.startsWith("blob:")&&!c&&!t.startsWith("blob:")&&URL.revokeObjectURL(d)}},[t,i,c]),(0,o.useEffect)(()=>()=>{!(d&&d.startsWith("blob:"))||c||(null==t?void 0:t.startsWith("blob:"))||(null==t?void 0:t.startsWith("data:"))||URL.revokeObjectURL(d)},[d,c,t]),u)?(0,r.jsx)("div",{className:"".concat(l," bg-muted animate-pulse flex items-center justify-center text-xs"),children:"Loading..."}):d?(0,r.jsx)("img",{src:d,alt:a,className:l}):null}},31886:(e,t,a)=>{a.d(t,{Cc:()=>h,FH:()=>i,hU:()=>c});var r=a(23464),o=a(8777),s=a.n(o);let n="http://103.159.68.35:3536/api",l=()=>{let e=Date.now().toString(),t=s().createHmac("sha256","6ECD762D4776742AFFB192CE8A148").update(e).digest("hex");return"".concat(e,".").concat(t)},i=r.A.create({baseURL:n,headers:{"Content-Type":"application/json"}});i.interceptors.request.use(e=>(e.headers["X-App-Signature"]=l(),e));let c=e=>{let t=r.A.create({baseURL:n,headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}});return t.interceptors.request.use(e=>(e.headers["X-App-Signature"]=l(),e)),t},d=()=>localStorage.getItem("token"),h=()=>{let e=d();if(!e)throw Error("No authentication token found");return c(e)}},31990:(e,t,a)=>{a.d(t,{f:()=>r,h:()=>o});let r=()=>{try{localStorage.clear();let e=Object.keys(localStorage),t=[/filter/i,/search/i,/selected/i,/state/i,/course/i];e.forEach(e=>{t.some(t=>t.test(e))&&(localStorage.removeItem(e),console.log("Cleared localStorage key: ".concat(e)))}),console.log("User data cleared successfully on logout")}catch(e){console.error("Error clearing user data:",e)}},o=()=>{try{let e=Object.keys(localStorage),t=[/filter/i,/search/i,/selected/i];e.forEach(e=>{t.some(t=>t.test(e))&&(localStorage.removeItem(e),console.log("Cleared filter key: ".concat(e)))}),console.log("Filters cleared successfully")}catch(e){console.error("Error clearing filters:",e)}}},35525:(e,t,a)=>{a.d(t,{y:()=>s});var r=a(31886),o=a(31990);let s={async login(e){try{let t=await r.FH.post("/auth/login",e);if(t.data.token)return localStorage.setItem("token",t.data.token),localStorage.setItem("id",t.data.user.id),localStorage.setItem("userType",t.data.user.role),(0,o.h)(),{token:t.data.token,role:t.data.user.role};return console.error("Login failed: No token received"),t.data.message}catch(e){var t,a;throw Error((null===(a=e.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.message)||"Login failed")}},async register(e){try{return(await r.FH.post("/auth/register",e)).data}catch(e){var t,a;throw Error((null===(a=e.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.message)||"Registration failed")}},async logout(){try{(0,o.f)()}catch(e){throw Error("Logout failed")}},async getCurrentUser(){try{return(await (0,r.Cc)().get("/auth/me")).data}catch(a){var e,t;throw Error((null===(t=a.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||"Failed to fetch current user")}},async refreshToken(){try{let e=await r.FH.post("/auth/refresh-token");return e.data.token&&localStorage.setItem("token",e.data.token),e.data}catch(a){var e,t;throw Error((null===(t=a.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||"Token refresh failed")}},async requestPasswordReset(e){try{return(await r.FH.post("/auth/request-password-reset",{email:e})).data}catch(e){var t,a;throw Error((null===(a=e.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.message)||"Password reset request failed")}},async resetPassword(e,t){try{return(await r.FH.post("/auth/reset-password",{token:e,password:t})).data}catch(e){var a,o;throw Error((null===(o=e.response)||void 0===o?void 0:null===(a=o.data)||void 0===a?void 0:a.message)||"Password reset failed")}},async changePassword(e,t){try{let a=localStorage.getItem("id");return(await (0,r.Cc)().post("/auth/change-password",{userId:a,oldPassword:e,newPassword:t})).data}catch(e){var a,o;throw Error((null===(o=e.response)||void 0===o?void 0:null===(a=o.data)||void 0===a?void 0:a.message)||"Password change failed")}}}},41387:(e,t,a)=>{a.d(t,{z:()=>M});var r=a(95155),o=a(6874),s=a.n(o),n=a(35695),l=a(53999),i=a(97168),c=a(5221),d=a(73783),h=a(69074),u=a(14186),f=a(71007),g=a(9530),m=a(53896),p=a(87949),b=a(79249),v=a(57434),A=a(32105),w=a(40235),y=a(72713),x=a(17580),j=a(92749),N=a(23227),C=a(94498),k=a(25273),S=a(30758),I=a(54416),T=a(34835),E=a(35525),R=a(59166);function M(e){let{role:t,isOpen:a=!0,onClose:o,isMobile:M=!1}=e,L=(0,n.usePathname)(),P=(0,n.useRouter)(),{roles:U=[],loading:D}="teacher"===t?(0,R.A)():{roles:[],loading:!1},_=async()=>{let e="student"===t?"/auth/student/login":"/auth/login";try{await E.y.logout(),P.push(e)}catch(t){console.error("Logout error:",t),P.push(e)}},F=[{href:"/student",label:"Dashboard",icon:d.A},{href:"/student/attendance",label:"My Attendance",icon:h.A},{href:"/student/timetable",label:"My Timetable",icon:u.A},{href:"/student/profile",label:"Profile",icon:f.A},{href:"/student/change-password",label:"Change Password",icon:g.A},{href:"http://njrlms.technonjr.org",label:"Techno NJR LMS",icon:m.A,external:!0}],H=[{href:"/teacher",label:"Dashboard",icon:d.A},{href:"/teacher/attendance",label:"Attendance",icon:h.A},{href:"/teacher/my-classes",label:"My Classes",icon:p.A},{href:"/teacher/substitution",label:"Substitution",icon:b.A},...U.includes("TIMETABLE_MASTER")?[{href:"/teacher/timetable",label:"Timetable",icon:u.A}]:[],...U.includes("COURSE_MASTER")?[{href:"/teacher/course-templates",label:"Course Templates",icon:v.A},{href:"/teacher/active-courses",label:"Active Courses",icon:A.A}]:[],{href:"/teacher/student-report",label:"Student Records",icon:w.A},{href:"/teacher/profile",label:"Profile",icon:f.A},{href:"/teacher/change-password",label:"Change Password",icon:g.A},{href:"http://njrlms.technonjr.org",label:"Techno NJR LMS",icon:m.A,external:!0}],O=[{href:"/admin",label:"Dashboard",icon:d.A},{href:"/admin/attendance",label:"Attendance",icon:h.A},{href:"/admin/classes-count",label:"Classes Count",icon:y.A},{href:"/admin/substitutions",label:"Substitutions History",icon:b.A},{href:"/admin/timetable",label:"Timetable",icon:u.A},{href:"/admin/students",label:"Students",icon:b.A},{href:"/admin/director",label:"Directors",icon:x.A},{href:"/admin/teachers",label:"Teachers",icon:j.A},{href:"/admin/hods",label:"HODs",icon:x.A},{href:"/admin/course-templates",label:"Course Templates",icon:v.A},{href:"/admin/active-courses",label:"Active Courses",icon:A.A},{href:"/admin/departments",label:"Departments",icon:N.A},{href:"/admin/batches",label:"Batches",icon:m.A},{href:"/admin/sections",label:"Sections",icon:C.A},{href:"/admin/student-report",label:"Reports",icon:w.A},{href:"/admin/admin-activity",label:"Admin Activity",icon:k.A},{href:"/admin/profile",label:"Profile",icon:f.A},{href:"/admin/change-password",label:"Change Password",icon:g.A},{href:"/admin/backup",label:"System Backup",icon:S.A},{href:"http://njrlms.technonjr.org",label:"Techno NJR LMS",icon:m.A,external:!0}],q={student:F,teacher:H,admin:O,hod:[{href:"/hod",label:"Dashboard",icon:d.A},{href:"/hod/attendance",label:"Attendance",icon:h.A},{href:"/hod/student-report",label:"Student Records",icon:w.A},{href:"/hod/students",label:"Students",icon:b.A},{href:"/hod/teachers",label:"Teachers",icon:j.A},{href:"/hod/course-templates",label:"Course Templates",icon:v.A},{href:"/hod/active-courses",label:"Active Courses",icon:A.A},{href:"/hod/my-classes",label:"My Classes",icon:p.A},{href:"/hod/substitution",label:"Substitution",icon:b.A},{href:"/hod/change-password",label:"Change Password",icon:g.A},{href:"/hod/profile",label:"Profile",icon:f.A},{href:"http://njrlms.technonjr.org",label:"Techno NJR LMS",icon:m.A,external:!0}],director:[{href:"/director",label:"Dashboard",icon:d.A},{href:"/director/attendance",label:"View Attendance",icon:y.A},{href:"/director/timetable",label:"View Timetables",icon:u.A},{href:"/director/student-report",label:"Student Reports",icon:x.A},{href:"/director/profile",label:"Profile",icon:f.A},{href:"/director/change-password",label:"Change Password",icon:g.A}]}[t];return M&&!a?null:(0,r.jsxs)("div",{className:(0,l.cn)("flex h-full w-64 flex-col border-r bg-background",M&&"fixed inset-y-0 left-0 z-50 shadow-lg"),children:[(0,r.jsxs)("div",{className:"flex h-14 items-center border-b px-4",children:[(0,r.jsx)(s(),{href:"/",className:"flex items-center flex-1",children:(0,r.jsx)(c.g,{width:170,height:46})}),M&&o&&(0,r.jsx)(i.$,{variant:"ghost",size:"sm",onClick:o,className:"p-1 h-8 w-8",children:(0,r.jsx)(I.A,{className:"h-4 w-4"})})]}),(0,r.jsx)("nav",{className:"flex-1 space-y-1 p-2 overflow-y-auto",children:q.map(e=>{let t=e.icon;return(0,r.jsx)(i.$,{variant:L===e.href?"secondary":"ghost",className:(0,l.cn)("w-full justify-start gap-2",L===e.href&&"bg-secondary"),asChild:!0,onClick:M?o:void 0,children:e.external?(0,r.jsxs)("a",{href:e.href,target:"_blank",rel:"noopener noreferrer",children:[(0,r.jsx)(t,{className:"h-4 w-4"}),e.label]}):(0,r.jsxs)(s(),{href:e.href,children:[(0,r.jsx)(t,{className:"h-4 w-4"}),e.label]})},e.href)})}),(0,r.jsx)("div",{className:"border-t p-2",children:(0,r.jsxs)(i.$,{variant:"ghost",className:"w-full justify-start gap-2",onClick:()=>{M&&o&&o(),_()},children:[(0,r.jsx)(T.A,{className:"h-4 w-4"}),"Logout"]})})]})}},45250:(e,t,a)=>{a.d(t,{a:()=>h});var r=a(95155),o=a(12115),s=a(35695),n=a(74783),l=a(71007),i=a(97168),c=a(69663),d=a(19764);function h(e){let{role:t,user:a,onMenuClick:h,isMobile:u,onUserUpdate:f}=e,g=(0,s.useRouter)(),[m,p]=(0,o.useState)(new Date),[b,v]=(0,o.useState)(0),A=()=>{p(new Date)};(0,o.useEffect)(()=>{A();let e=setInterval(A,1e3);return()=>clearInterval(e)},[]),(0,o.useEffect)(()=>{let e=e=>{console.log("Header: Profile picture update event received"),v(e=>e+1),f&&e.detail&&f(e.detail)};return window.addEventListener("profilePictureUpdated",e),()=>{window.removeEventListener("profilePictureUpdated",e)}},[f]);let w=null==a?void 0:a.name.split(" ").map(e=>e[0]).join("").toUpperCase();return(0,r.jsx)("div",{className:"flex h-14 items-center border-b bg-background px-4",children:(0,r.jsxs)("div",{className:"flex flex-1 items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[u&&h&&(0,r.jsx)(i.$,{variant:"ghost",size:"sm",onClick:h,className:"p-2 h-8 w-8",children:(0,r.jsx)(n.A,{className:"h-4 w-4"})}),(0,r.jsxs)("h2",{className:"text-lg font-semibold",children:[t.charAt(0).toUpperCase()+t.slice(1)," Dashboard"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)(i.$,{variant:"ghost",className:"relative h-8 w-8 rounded-full p-0",onClick:()=>{switch(t){case"student":g.push("/student/profile");break;case"teacher":g.push("/teacher/profile");break;case"admin":g.push("/admin/profile");break;case"hod":g.push("/hod/profile");break;case"director":g.push("/director/profile");break;default:g.push("/profile")}},children:(0,r.jsx)(c.eu,{className:"h-8 w-8",children:(null==a?void 0:a.avatar)?(0,r.jsx)(d.v,{src:a.avatar,alt:a.name,className:"h-full w-full object-cover rounded-full",role:t},"".concat(a.avatar,"-").concat(b)):(0,r.jsx)(c.q5,{className:"bg-primary/10",children:w||(0,r.jsx)(l.A,{className:"h-4 w-4"})})})}),(0,r.jsxs)("div",{className:"text-right hidden sm:block",children:[(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:"Time"}),(0,r.jsx)("div",{className:"text-sm font-medium",children:m.toLocaleString("en-IN",{timeZone:"Asia/Kolkata",day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0})})]}),(0,r.jsx)("div",{className:"text-right sm:hidden",children:(0,r.jsx)("div",{className:"text-sm font-medium",children:m.toLocaleTimeString("en-IN",{timeZone:"Asia/Kolkata",hour:"2-digit",minute:"2-digit",hour12:!0})})})]})]})})}},53999:(e,t,a)=>{a.d(t,{cn:()=>s,e:()=>n});var r=a(52596),o=a(39688);function s(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,o.QP)((0,r.$)(t))}function n(e){let t=parseInt(e.split("-")[0]),a=new Date,r=a.getFullYear();return Math.min(Math.max(2*(r-t)+ +(a.getMonth()+1>=7),1),8)}},59166:(e,t,a)=>{a.d(t,{A:()=>l});var r=a(12115),o=a(31886);let s=async e=>{try{return(await (0,o.Cc)().post("/teacher/dashboard/subroles",{userId:e})).data}catch(e){throw console.error("Error fetching teacher subRoles:",e),e}},n=async e=>{try{let{subRoles:t}=await s(e),a=t.map(e=>e.role);return{canManageAttendance:a.includes("ATTENDANCE_MASTER"),canManageCourses:a.includes("COURSE_MASTER"),canManageTimetable:a.includes("TIMETABLE_MASTER"),roles:a}}catch(e){return console.error("Error getting teacher permissions:",e),{canManageAttendance:!1,canManageCourses:!1,canManageTimetable:!1,roles:[],error:e}}},l=function(){let[e,t]=(0,r.useState)(null),[a,o]=(0,r.useState)({canManageAttendance:!1,canManageCourses:!1,canManageTimetable:!1,roles:[],loading:!0});(0,r.useEffect)(()=>{t(localStorage.getItem("id"))},[]);let s=(0,r.useCallback)(async()=>{if(!e){o(e=>({...e,loading:!1}));return}try{let t=await n(e);o({...t,loading:!1}),localStorage.setItem("subRoles",JSON.stringify(t.roles))}catch(e){o({canManageAttendance:!1,canManageCourses:!1,canManageTimetable:!1,roles:[],loading:!1,error:e})}},[e]),l=(0,r.useCallback)(async()=>{o(e=>({...e,loading:!0})),await s()},[s]);return(0,r.useEffect)(()=>{s()},[s]),{...a,hasRole:e=>a.roles.includes(e),hasAnyRole:e=>e.some(e=>a.roles.includes(e)),refreshPermissions:l}}},69663:(e,t,a)=>{a.d(t,{BK:()=>i,eu:()=>l,q5:()=>c});var r=a(95155),o=a(12115),s=a(85977),n=a(53999);let l=o.forwardRef((e,t)=>{let{className:a,...o}=e;return(0,r.jsx)(s.bL,{ref:t,className:(0,n.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a),...o})});l.displayName=s.bL.displayName;let i=o.forwardRef((e,t)=>{let{className:a,...o}=e;return(0,r.jsx)(s._V,{ref:t,className:(0,n.cn)("aspect-square h-full w-full",a),...o})});i.displayName=s._V.displayName;let c=o.forwardRef((e,t)=>{let{className:a,...o}=e;return(0,r.jsx)(s.H4,{ref:t,className:(0,n.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",a),...o})});c.displayName=s.H4.displayName},97168:(e,t,a)=>{a.d(t,{$:()=>c,r:()=>i});var r=a(95155),o=a(12115),s=a(99708),n=a(74466),l=a(53999);let i=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=o.forwardRef((e,t)=>{let{className:a,variant:o,size:n,asChild:c=!1,...d}=e,h=c?s.DX:"button";return(0,r.jsx)(h,{className:(0,l.cn)(i({variant:o,size:n,className:a})),ref:t,...d})});c.displayName="Button"}}]);